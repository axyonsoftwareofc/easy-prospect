// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String      @id @default(cuid())
  name          String?
  email         String      @unique
  emailVerified DateTime?
  password      String?
  image         String?
  plano         String      @default("free")
  creditos      Int         @default(10)
  accounts      Account[]
  sessions      Session[]
  downloads     Download[]
  assinatura    Assinatura?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Empresa {
  id              String    @id @default(cuid())
  nome            String
  nomeFantasia    String?
  cnpj            String?   @unique
  email           String?
  emailSecundario String?
  telefone        String?
  telefone2       String?
  whatsapp        String?
  site            String?
  continente      String?
  pais            String
  estado          String?
  cidade          String?
  endereco        String?
  cep             String?
  setor           String
  subsetor        String?
  porte           String?
  faturamento     String?
  funcionarios    String?
  tipoNegocio     String?
  isImportador    Boolean   @default(false)
  isExportador    Boolean   @default(false)
  isDistribuidor  Boolean   @default(false)
  isFabricante    Boolean   @default(false)
  isVarejo        Boolean   @default(false)
  isAtacado       Boolean   @default(false)
  responsavel     String?
  cargo           String?
  linkedinEmpresa String?
  linkedinContato String?
  instagram       String?
  facebook        String?
  fonte           String?
  qualidade       Int       @default(80)
  verificadoEm    DateTime?
  ativo           Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([pais])
  @@index([setor])
  @@index([continente])
  @@index([ativo])
}

model Plano {
  id                 String       @id @default(cuid())
  nome               String       @unique
  nomeExibicao       String
  preco              Float
  creditosMensal     Int
  setoresMax         Int
  paisesMax          Int
  exportPDF          Boolean      @default(false)
  exportCSV          Boolean      @default(true)
  acessoAPI          Boolean      @default(false)
  suportePrioritario Boolean      @default(false)
  assinaturas        Assinatura[]
  ativo              Boolean      @default(true)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model Assinatura {
  id                   String    @id @default(cuid())
  userId               String    @unique
  user                 User      @relation(fields: [userId], references: [id])
  planoId              String
  plano                Plano     @relation(fields: [planoId], references: [id])
  status               String    @default("ativa")
  dataInicio           DateTime  @default(now())
  dataRenovacao        DateTime?
  dataExpiracao        DateTime?
  stripeCustomerId     String?
  stripeSubscriptionId String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
}

model Download {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  filtros        String
  quantidade     Int
  creditosUsados Int
  formato        String
  arquivoUrl     String?
  createdAt      DateTime @default(now())

  @@index([userId])
}

model Lista {
  id             String   @id @default(cuid())
  nome           String
  descricao      String?
  segmentos      String
  regioes        String
  paises         String
  quantidade     Int
  preco          Float
  precoDesconto  Float?
  camposInclusos String
  taxaValidacao  Float    @default(95)
  arquivoUrl     String?
  amostraUrl     String?
  imagemUrl      String?
  destaque       Boolean  @default(false)
  ativo          Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
